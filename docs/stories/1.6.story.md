# Story 1.6: Substrate Importer

## Status

Draft

## Executor Assignment

executor: "@dev"
quality_gate: "@architect"
quality_gate_tools: [code_review, integration_review]

## Story

**As a** NEXUS operator,
**I want** to import existing documents and transform them into categorized substrates,
**so that** I don't rewrite manually what already exists.

## Acceptance Criteria

1. Comando `*substrate import {file-path}` analisa documento e sugere split em substratos
2. Preview com numeraÃ§Ã£o e categorizaÃ§Ã£o proposta
3. UsuÃ¡rio aprova todos, edita individualmente ou rejeita
4. Suporta markdown, texto, JSON
5. Cria com frontmatter e source para rastreabilidade
6. Teste: importar Base Comercial e verificar equivalÃªncia

## ðŸ¤– CodeRabbit Integration

> **CodeRabbit Integration**: Disabled

## Tasks / Subtasks

- [ ] Task 1: Implementar Capture Engine modules (AC: 1, 2, 4, 5)
  - [ ] 1.1 Criar `src/capture/index.js` â€” API pÃºblica
  - [ ] 1.2 Criar `src/capture/importer.js`:
    - `importFile(filePath, project)` â†’ `SubstrateSuggestion[]`
    - Detecta formato (md, txt, json)
    - Retorna sugestÃµes com preview
  - [ ] 1.3 Criar `src/capture/splitter.js`:
    - `splitDocument(content, format)` â†’ chunks <= 200 palavras
    - EstratÃ©gia: split por headers (md), parÃ¡grafos (txt), keys (json)
    - Respeita limites semÃ¢nticos (nÃ£o cortar no meio de frase)
  - [ ] 1.4 Criar `src/capture/categorizer.js`:
    - `categorize(chunk)` â†’ SubstrateCategory
    - HeurÃ­stica por keywords: "preÃ§o/oferta" â†’ offer, "dor/problema" â†’ pain, etc.
- [ ] Task 2: Implementar CLI command (AC: 1, 2, 3)
  - [ ] 2.1 Criar `src/cli/capture.js` â€” Commander: `import`
  - [ ] 2.2 Preview: mostra tabela com ID proposto, categoria, primeiras palavras, word count
  - [ ] 2.3 OpÃ§Ãµes: [1] Aprovar todos [2] Editar individualmente [3] Rejeitar
  - [ ] 2.4 Cada substrato criado com `source: {original file path}` no frontmatter
- [ ] Task 3: Testes (AC: todos)
  - [ ] 3.1 `tests/capture/splitter.test.js` â€” split md, txt, json, respeita limite 200 palavras
  - [ ] 3.2 `tests/capture/categorizer.test.js` â€” categorizaÃ§Ã£o por keywords
  - [ ] 3.3 `tests/capture/importer.test.js` â€” fluxo completo import
- [ ] Task 4: ValidaÃ§Ã£o final
  - [ ] 4.1 `npm run validate` passa

## Dev Notes

### DependÃªncia

**Depende de Story 1.2** â€” usa parser.js, validator.js, writer.js para criar substratos.

### Arquitetura Relevante

**Capture Engine Structure** [Source: architecture/nexus-architecture-v1.md#6.6]:
```
src/capture/
â”œâ”€â”€ index.js
â”œâ”€â”€ importer.js        # importFile()
â”œâ”€â”€ splitter.js        # splitDocument()
â”œâ”€â”€ categorizer.js     # categorize()
â””â”€â”€ processor.js       # (Story 4.3)
```

**Key Interface** [Source: architecture/nexus-architecture-v1.md#6.6]:
- `importFile(filePath, project)` â†’ `SubstrateSuggestion[]`

**Import Flow** [Source: architecture/nexus-architecture-v1.md#8.3]:
1. Read file â†’ analyze + split em chunks <= 200 palavras
2. Categorize cada chunk
3. Preview com numeraÃ§Ã£o
4. UsuÃ¡rio aprova/edita/rejeita
5. Cria substratos com frontmatter e `source` para rastreabilidade

**Substrate Categories (para categorizer)** [Source: architecture/nexus-architecture-v1.md#4.2]:
identity, product, pain, solution, objection, differentiator, proof, offer, audience, context

**Formatos suportados:**
- Markdown: split por headers (`##`, `###`)
- Texto: split por parÃ¡grafos (double newline)
- JSON: split por top-level keys

### Testing

- Framework: Vitest, globals: true
- Location: `tests/capture/`
- Key tests: split com diferentes formatos, categorizaÃ§Ã£o, fluxo completo
- Integration test: importar fixture e verificar substratos gerados

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-02-25 | 0.1 | Story criada | River (SM) |

## Dev Agent Record

### Agent Model Used
_To be filled by dev agent_

### Debug Log References
_To be filled by dev agent_

### Completion Notes List
_To be filled by dev agent_

### File List
_To be filled by dev agent_

## QA Results
_To be filled by QA agent_
