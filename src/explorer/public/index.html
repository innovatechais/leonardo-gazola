<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NEXUS Explorer</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{--bg:#0f0f13;--surface:#16161d;--surface2:#1e1e28;--border:#2a2a38;--text:#e0e0e8;--muted:#8888a0;--accent:#6c5ce7;--accent2:#a29bfe;--green:#00b894;--orange:#fdcb6e;--red:#e17055;--blue:#74b9ff;--pink:#fd79a8;--radius:12px;--font:'SF Mono',Monaco,'Cascadia Code',Consolas,monospace}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:var(--bg);color:var(--text);display:flex;height:100vh;overflow:hidden}
a{color:var(--accent2);text-decoration:none}
::-webkit-scrollbar{width:6px}
::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{background:var(--border);border-radius:3px}

/* Sidebar */
.sidebar{width:260px;background:var(--surface);border-right:1px solid var(--border);display:flex;flex-direction:column;flex-shrink:0}
.logo{padding:24px 20px;border-bottom:1px solid var(--border)}
.logo h1{font-size:20px;background:linear-gradient(135deg,var(--accent),var(--accent2));-webkit-background-clip:text;-webkit-text-fill-color:transparent;letter-spacing:1px}
.logo p{font-size:11px;color:var(--muted);margin-top:4px}
.nav{flex:1;overflow-y:auto;padding:12px 0}
.nav-item{display:flex;align-items:center;gap:10px;padding:10px 20px;cursor:pointer;font-size:14px;color:var(--muted);transition:all .15s}
.nav-item:hover{background:var(--surface2);color:var(--text)}
.nav-item.active{background:linear-gradient(90deg,rgba(108,92,231,.15),transparent);color:var(--accent2);border-left:3px solid var(--accent)}
.nav-item .icon{font-size:18px;width:24px;text-align:center}
.nav-item .badge{margin-left:auto;background:var(--surface2);color:var(--muted);font-size:11px;padding:2px 8px;border-radius:10px}
.stats-bar{padding:16px 20px;border-top:1px solid var(--border);font-size:12px;color:var(--muted)}
.stats-bar .stat{display:flex;justify-content:space-between;margin-bottom:4px}
.stats-bar .stat span:last-child{color:var(--accent2)}

/* Main */
.main{flex:1;overflow-y:auto;padding:32px 40px}
.section{display:none}
.section.active{display:block}
.section h2{font-size:24px;margin-bottom:8px}
.section .subtitle{color:var(--muted);margin-bottom:24px;font-size:14px}

/* Cards */
.card-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:16px;margin-bottom:32px}
.card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:20px;transition:all .2s}
.card:hover{border-color:var(--accent);transform:translateY(-2px);box-shadow:0 8px 24px rgba(108,92,231,.1)}
.card .card-icon{font-size:28px;margin-bottom:12px}
.card h3{font-size:16px;margin-bottom:6px}
.card p{font-size:13px;color:var(--muted);line-height:1.5}
.card .tag{display:inline-block;font-size:11px;padding:2px 8px;border-radius:6px;background:var(--surface2);color:var(--accent2);margin-top:8px;margin-right:4px}

/* Command List */
.cmd-group{margin-bottom:28px}
.cmd-group h3{font-size:15px;color:var(--accent2);margin-bottom:12px;padding-bottom:8px;border-bottom:1px solid var(--border)}
.cmd-row{display:flex;align-items:center;gap:12px;padding:8px 12px;border-radius:8px;margin-bottom:4px;transition:background .15s}
.cmd-row:hover{background:var(--surface2)}
.cmd-code{font-family:var(--font);font-size:13px;color:var(--green);min-width:320px;cursor:pointer;position:relative}
.cmd-code:hover::after{content:'üìã';position:absolute;right:-24px;top:0}
.cmd-desc{font-size:13px;color:var(--muted);flex:1}
.cmd-example{font-family:var(--font);font-size:12px;color:var(--blue);opacity:.7}

/* SCA Flow */
.sca-flow{display:flex;align-items:center;justify-content:center;gap:8px;margin:32px 0;flex-wrap:wrap}
.sca-node{background:var(--surface);border:2px solid var(--border);border-radius:var(--radius);padding:20px 28px;text-align:center;min-width:140px;transition:all .3s}
.sca-node:hover{border-color:var(--accent);transform:scale(1.05)}
.sca-node .node-icon{font-size:32px;margin-bottom:8px}
.sca-node h4{font-size:14px;margin-bottom:4px}
.sca-node p{font-size:11px;color:var(--muted)}
.sca-arrow{font-size:24px;color:var(--accent)}

/* Category pills */
.pills{display:flex;flex-wrap:wrap;gap:6px;margin:12px 0}
.pill{font-size:12px;padding:4px 12px;border-radius:20px;background:var(--surface2);color:var(--muted);border:1px solid var(--border)}

/* Tables */
.data-table{width:100%;border-collapse:collapse;margin:16px 0}
.data-table th{text-align:left;font-size:12px;color:var(--muted);text-transform:uppercase;letter-spacing:.5px;padding:8px 12px;border-bottom:1px solid var(--border)}
.data-table td{padding:10px 12px;font-size:13px;border-bottom:1px solid rgba(42,42,56,.5)}
.data-table tr:hover td{background:var(--surface2)}

/* Architecture diagram */
.arch-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:12px}
.arch-module{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:16px;transition:all .2s}
.arch-module:hover{border-color:var(--accent)}
.arch-module h4{font-size:14px;margin-bottom:4px;color:var(--accent2)}
.arch-module code{font-family:var(--font);font-size:11px;color:var(--muted)}
.arch-module p{font-size:12px;color:var(--muted);margin-top:6px}

/* Data flow */
.flow-diagram{display:flex;flex-wrap:wrap;gap:8px;margin:24px 0;align-items:center}
.flow-step{background:var(--surface);border:1px solid var(--border);border-radius:8px;padding:8px 16px;font-size:13px}
.flow-arrow{color:var(--accent);font-size:16px}

/* Loading */
.loading{display:flex;align-items:center;justify-content:center;height:200px;color:var(--muted)}
.loading::after{content:'';width:24px;height:24px;border:2px solid var(--border);border-top-color:var(--accent);border-radius:50%;animation:spin .6s linear infinite;margin-left:12px}
@keyframes spin{to{transform:rotate(360deg)}}

/* Status badge */
.status{display:inline-block;font-size:11px;padding:2px 8px;border-radius:6px;font-weight:600}
.status.ready,.status.enabled{background:rgba(0,184,148,.15);color:var(--green)}
.status.draft{background:rgba(253,203,110,.15);color:var(--orange)}
.status.disabled{background:rgba(225,112,85,.15);color:var(--red)}

/* Toast */
.toast{position:fixed;bottom:20px;right:20px;background:var(--accent);color:white;padding:10px 20px;border-radius:8px;font-size:13px;opacity:0;transition:opacity .3s;pointer-events:none;z-index:100}
.toast.show{opacity:1}
</style>
</head>
<body>

<div class="sidebar">
  <div class="logo">
    <h1>‚ö° NEXUS</h1>
    <p>AI-Powered Company OS</p>
  </div>
  <div class="nav" id="nav">
    <div class="nav-item active" data-section="overview"><span class="icon">üè†</span>Overview</div>
    <div class="nav-item" data-section="cli"><span class="icon">üíª</span>CLI Commands</div>
    <div class="nav-item" data-section="sca"><span class="icon">üß¨</span>SCA Architecture</div>
    <div class="nav-item" data-section="projects"><span class="icon">üìÅ</span>Projects<span class="badge" id="badge-projects">-</span></div>
    <div class="nav-item" data-section="squads"><span class="icon">üéØ</span>Squads<span class="badge" id="badge-squads">-</span></div>
    <div class="nav-item" data-section="pipelines"><span class="icon">üîÑ</span>Pipelines<span class="badge" id="badge-pipelines">-</span></div>
    <div class="nav-item" data-section="integrations"><span class="icon">üîå</span>Integrations<span class="badge" id="badge-integrations">-</span></div>
    <div class="nav-item" data-section="architecture"><span class="icon">üèóÔ∏è</span>Architecture</div>
  </div>
  <div class="stats-bar" id="stats-bar"></div>
</div>

<div class="main" id="main">
  <!-- Overview -->
  <div class="section active" id="sec-overview">
    <h2>Welcome to NEXUS Explorer</h2>
    <p class="subtitle">Navigate the entire system visually. Click sections in the sidebar to explore.</p>
    <div class="card-grid" id="overview-cards"></div>
    <h3 style="margin-bottom:16px;color:var(--accent2)">üîÑ Data Flow</h3>
    <div class="sca-flow">
      <div class="sca-node"><div class="node-icon">üìù</div><h4>Request</h4><p>"Make a landing page"</p></div>
      <div class="sca-arrow">‚Üí</div>
      <div class="sca-node"><div class="node-icon">üîç</div><h4>Router</h4><p>NLP Analyzer</p></div>
      <div class="sca-arrow">‚Üí</div>
      <div class="sca-node"><div class="node-icon">üéØ</div><h4>Squad</h4><p>Best match</p></div>
      <div class="sca-arrow">‚Üí</div>
      <div class="sca-node"><div class="node-icon">üß±</div><h4>Context</h4><p>Blocks injected</p></div>
      <div class="sca-arrow">‚Üí</div>
      <div class="sca-node"><div class="node-icon">üìÑ</div><h4>Output</h4><p>Final content</p></div>
    </div>
  </div>

  <!-- CLI -->
  <div class="section" id="sec-cli">
    <h2>üíª CLI Commands</h2>
    <p class="subtitle">All available commands. Click any command to copy it.</p>
    <div id="cli-commands"></div>
  </div>

  <!-- SCA -->
  <div class="section" id="sec-sca">
    <h2>üß¨ Sales Content Architecture</h2>
    <p class="subtitle" id="sca-desc"></p>
    <div class="sca-flow" id="sca-flow"></div>
    <div id="sca-levels"></div>
  </div>

  <!-- Projects -->
  <div class="section" id="sec-projects">
    <h2>üìÅ Projects</h2>
    <p class="subtitle">All projects in the workspace</p>
    <div class="card-grid" id="project-cards"></div>
  </div>

  <!-- Squads -->
  <div class="section" id="sec-squads">
    <h2>üéØ Squads</h2>
    <p class="subtitle">AI agent teams registered in the system</p>
    <div class="card-grid" id="squad-cards"></div>
  </div>

  <!-- Pipelines -->
  <div class="section" id="sec-pipelines">
    <h2>üîÑ Pipelines</h2>
    <p class="subtitle">Multi-step content production workflows</p>
    <div class="card-grid" id="pipeline-cards"></div>
  </div>

  <!-- Integrations -->
  <div class="section" id="sec-integrations">
    <h2>üîå Integrations</h2>
    <p class="subtitle">External services connected to NEXUS</p>
    <table class="data-table" id="integrations-table">
      <thead><tr><th>Service</th><th>Type</th><th>Status</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- Architecture -->
  <div class="section" id="sec-architecture">
    <h2>üèóÔ∏è Architecture Map</h2>
    <p class="subtitle">System modules and data flow</p>
    <h3 style="margin:20px 0 12px;color:var(--accent2)">Modules</h3>
    <div class="arch-grid" id="arch-modules"></div>
    <h3 style="margin:24px 0 12px;color:var(--accent2)">Data Flow</h3>
    <div class="flow-diagram" id="arch-flow"></div>
  </div>
</div>

<div class="toast" id="toast">Copied!</div>

<script>
let DATA = null

async function loadData() {
  const res = await fetch('/api/map')
  DATA = await res.json()
  render()
}

function render() {
  renderBadges()
  renderStatsBar()
  renderOverview()
  renderCli()
  renderSca()
  renderProjects()
  renderSquads()
  renderPipelines()
  renderIntegrations()
  renderArchitecture()
}

function renderBadges() {
  const o = DATA.overview
  setText('badge-projects', o.totalProjects)
  setText('badge-squads', o.totalSquads)
  setText('badge-pipelines', o.totalPipelines)
  setText('badge-integrations', o.totalIntegrations)
}

function renderStatsBar() {
  const o = DATA.overview
  document.getElementById('stats-bar').innerHTML = `
    <div class="stat"><span>Projects</span><span>${o.totalProjects}</span></div>
    <div class="stat"><span>Squads</span><span>${o.totalSquads}</span></div>
    <div class="stat"><span>Pipelines</span><span>${o.totalPipelines}</span></div>
    <div class="stat"><span>Integrations</span><span>${o.totalIntegrations}</span></div>
  `
}

function renderOverview() {
  const cards = [
    { icon: 'üìÅ', title: 'Projects', desc: `${DATA.overview.totalProjects} projects in workspace`, section: 'projects' },
    { icon: 'üéØ', title: 'Squads', desc: `${DATA.overview.totalSquads} AI agent squads`, section: 'squads' },
    { icon: 'üîÑ', title: 'Pipelines', desc: `${DATA.overview.totalPipelines} campaign pipelines`, section: 'pipelines' },
    { icon: 'üß¨', title: 'SCA', desc: 'Substrates ‚Üí Blocks ‚Üí Outputs', section: 'sca' },
    { icon: 'üíª', title: 'CLI', desc: `${DATA.cli.reduce((s,g)=>s+g.commands.length,0)} commands available`, section: 'cli' },
    { icon: 'üèóÔ∏è', title: 'Architecture', desc: `${DATA.architecture.modules.length} modules`, section: 'architecture' },
  ]
  document.getElementById('overview-cards').innerHTML = cards.map(c => `
    <div class="card" style="cursor:pointer" onclick="navigate('${c.section}')">
      <div class="card-icon">${c.icon}</div>
      <h3>${c.title}</h3>
      <p>${c.desc}</p>
    </div>
  `).join('')
}

function renderCli() {
  document.getElementById('cli-commands').innerHTML = DATA.cli.map(g => `
    <div class="cmd-group">
      <h3>${g.group}</h3>
      ${g.commands.map(c => `
        <div class="cmd-row">
          <span class="cmd-code" onclick="copyText('${c.example}')" title="Click to copy">${c.cmd}</span>
          <span class="cmd-desc">${c.desc}</span>
        </div>
      `).join('')}
    </div>
  `).join('')
}

function renderSca() {
  const sca = DATA.sca
  document.getElementById('sca-desc').textContent = sca.description

  document.getElementById('sca-flow').innerHTML = sca.levels.map((l, i) => `
    ${i > 0 ? '<div class="sca-arrow">‚Üí</div>' : ''}
    <div class="sca-node">
      <div class="node-icon">${l.icon}</div>
      <h4>${l.name}</h4>
      <p>${l.idPattern}</p>
    </div>
  `).join('')

  document.getElementById('sca-levels').innerHTML = sca.levels.map(l => `
    <div class="card" style="margin-bottom:16px">
      <div class="card-icon">${l.icon}</div>
      <h3>${l.name}</h3>
      <p>${l.description}</p>
      ${l.categories ? `<div class="pills">${l.categories.map(c => `<span class="pill">${c}</span>`).join('')}</div>` : ''}
      ${l.funnelStages ? `<div class="pills">${l.funnelStages.map(s => `<span class="pill">${s}</span>`).join('')}</div>` : ''}
      ${l.examples ? `<div class="pills">${l.examples.map(e => `<span class="pill">${e}</span>`).join('')}</div>` : ''}
      ${l.statuses ? `<p style="margin-top:8px;font-size:12px;color:var(--muted)">Status: ${l.statuses.join(' ‚Üí ')}</p>` : ''}
      <p style="margin-top:4px;font-size:12px;color:var(--muted)">ID pattern: <code style="color:var(--green)">${l.idPattern}</code></p>
    </div>
  `).join('')
}

function renderProjects() {
  const el = document.getElementById('project-cards')
  if (DATA.projects.length === 0) {
    el.innerHTML = '<p style="color:var(--muted)">No projects yet. Run <code style="color:var(--green)">nexus project create my-project</code> to start.</p>'
    return
  }
  el.innerHTML = DATA.projects.map(p => `
    <div class="card">
      <div class="card-icon">üìÅ</div>
      <h3>${p.name || p.slug}</h3>
      <p>Slug: <code style="color:var(--green)">${p.slug}</code></p>
      <span class="tag">${p.visibility}</span>
      <span class="tag">${p.market_profile}</span>
      ${p.stats ? `<p style="margin-top:8px;font-size:12px;color:var(--muted)">${p.stats.substrates}S ${p.stats.blocks}B ${p.stats.contexts}C ${p.stats.outputs}O</p>` : ''}
    </div>
  `).join('')
}

function renderSquads() {
  const el = document.getElementById('squad-cards')
  if (DATA.squads.length === 0) {
    el.innerHTML = '<p style="color:var(--muted)">No squads found in squads/ directory.</p>'
    return
  }
  el.innerHTML = DATA.squads.map(s => `
    <div class="card">
      <div class="card-icon">üéØ</div>
      <h3>${s.name}</h3>
      <span class="tag">${s.category}</span>
      ${s.registered ? '<span class="status ready">registered</span>' : '<span class="status draft">unregistered</span>'}
      ${s.agents_count ? `<p style="margin-top:8px;font-size:12px;color:var(--muted)">${s.agents_count} agents</p>` : ''}
      ${s.produces?.length ? `<div class="pills" style="margin-top:8px">${s.produces.map(p => `<span class="pill">${p}</span>`).join('')}</div>` : ''}
    </div>
  `).join('')
}

function renderPipelines() {
  const el = document.getElementById('pipeline-cards')
  if (DATA.pipelines.length === 0) {
    el.innerHTML = '<p style="color:var(--muted)">No pipelines found in config/pipelines/.</p>'
    return
  }
  el.innerHTML = DATA.pipelines.map(p => `
    <div class="card">
      <div class="card-icon">üîÑ</div>
      <h3>${p.name}</h3>
      <p>${p.description}</p>
      <p style="margin-top:8px;font-size:12px;color:var(--muted)">${p.stepsCount} steps | v${p.version}</p>
      ${p.detail?.steps ? `
        <div style="margin-top:12px;padding-top:12px;border-top:1px solid var(--border)">
          ${p.detail.steps.map((s, i) => `
            <div style="font-size:12px;color:var(--muted);margin-bottom:4px">
              ${i > 0 ? '<span style="color:var(--accent);margin-right:4px">‚Üì</span>' : ''}
              <span style="color:var(--green)">[${s.id}]</span> ${s.name}
              <span style="color:var(--blue)">‚Üí ${s.squad}</span>
              ${s.checkpoint ? 'üîç' : ''}
            </div>
          `).join('')}
        </div>
      ` : ''}
    </div>
  `).join('')
}

function renderIntegrations() {
  const tbody = document.querySelector('#integrations-table tbody')
  if (DATA.integrations.length === 0) {
    tbody.innerHTML = '<tr><td colspan="3" style="color:var(--muted)">No integrations configured.</td></tr>'
    return
  }
  tbody.innerHTML = DATA.integrations.map(i => `
    <tr>
      <td><strong>${i.name}</strong></td>
      <td>${i.type}</td>
      <td><span class="status ${i.status}">${i.status}</span></td>
    </tr>
  `).join('')
}

function renderArchitecture() {
  document.getElementById('arch-modules').innerHTML = DATA.architecture.modules.map(m => `
    <div class="arch-module">
      <h4>${m.name}</h4>
      <code>${m.path}</code>
      <p>${m.desc}</p>
    </div>
  `).join('')

  document.getElementById('arch-flow').innerHTML = DATA.architecture.dataFlow.map((f, i) => `
    ${i > 0 ? '' : ''}
    <div class="flow-step">${f.from}</div>
    <div class="flow-arrow">‚Üí<span style="font-size:10px;vertical-align:super;color:var(--muted)">${f.label}</span>‚Üí</div>
    <div class="flow-step">${f.to}</div>
    ${i < DATA.architecture.dataFlow.length - 1 ? '<div style="width:100%;height:4px"></div>' : ''}
  `).join('')
}

// Navigation
document.getElementById('nav').addEventListener('click', e => {
  const item = e.target.closest('.nav-item')
  if (!item) return
  navigate(item.dataset.section)
})

function navigate(section) {
  document.querySelectorAll('.nav-item').forEach(n => n.classList.toggle('active', n.dataset.section === section))
  document.querySelectorAll('.section').forEach(s => s.classList.toggle('active', s.id === `sec-${section}`))
}

// Copy
function copyText(text) {
  navigator.clipboard.writeText(text)
  const toast = document.getElementById('toast')
  toast.textContent = `Copied: ${text}`
  toast.classList.add('show')
  setTimeout(() => toast.classList.remove('show'), 1500)
}

function setText(id, val) {
  const el = document.getElementById(id)
  if (el) el.textContent = val
}

// Init
loadData()
</script>
</body>
</html>
